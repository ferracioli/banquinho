/* gERAL */



/* eSPECIALISTA */
SELECT E.ESPECIALISTA, SUM(E.GANHOS_ATIVIDADES_TOTAIS) AS GANHOS_TOTAIS, E.ORGANIZADOR, E.CODIGO_INTERNO
    FROM ((
        SELECT AU.ESPECIALISTA, -1*(SUM(G.GASTOS_GANHOS)) AS GANHOS_ATIVIDADES_TOTAIS, C.ORGANIZADOR, C.CODIGO_INTERNO 
        FROM AUXILIA AU JOIN CARAVANA C
        ON (AU.ORGANIZADOR = C.ORGANIZADOR AND AU.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ITINERARIO I
        ON (C.ORGANIZADOR = I.ORGANIZADOR AND C.CODIGO_INTERNO = I.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO) JOIN ATIVIDADE A
        ON (AD.ITINERARIO = A.ITINERARIO) JOIN GRUPO_DE_PARTICIPANTES G
        ON (A.ID = G.ATIVIDADE) JOIN ENTRA E
        ON (G.ATIVIDADE = E.ATIVIDADE AND G.CATEGORIA = E.CATEGORIA AND AU.ESPECIALISTA = E.USUARIO AND E.USUARIO = AD.USUARIO)
        GROUP BY AU.ESPECIALISTA, C.ORGANIZADOR, C.CODIGO_INTERNO
    ) 
    UNION ALL (
        SELECT AU.ESPECIALISTA, -1*SUM(AD.CUSTO_BASE) AS CUSTO_BASE_TOTAL, C.ORGANIZADOR, C.CODIGO_INTERNO
        FROM AUXILIA AU JOIN CARAVANA C
        ON (AU.ORGANIZADOR = C.ORGANIZADOR AND AU.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ITINERARIO I
        ON (I.ORGANIZADOR = C.ORGANIZADOR AND I.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO AND AU.ESPECIALISTA = AD.USUARIO) 
        GROUP BY C.ORGANIZADOR, C.CODIGO_INTERNO, AU.ESPECIALISTA
    )) E 
    GROUP BY E.ESPECIALISTA, E.ORGANIZADOR, E.CODIGO_INTERNO;


/* CONTAGEM DIVIS√ÉO */
SELECT AD.USUARIO, I.ORGANIZADOR, I.CODIGO_INTERNO, COUNT(I.CODIGO_INTERNO) AS TOTAL_ITINERARIOS
    FROM ADENTRA AS AD, ITINERARIO AS I
    WHERE AD.ITINERARIO = I.ID
    GROUP BY AD.USUARIO, I.ORGANIZADOR, I.CODIGO_INTERNO
    HAVING (COUNT(I.CODIGO_INTERNO) = (SELECT COUNT(C.CODIGO_INTERNO) FROM CARAVANA AS C
                                            WHERE I.ORGANIZADOR = C.ORGANIZADOR ))
    ORDER BY AD.USUARIO;
