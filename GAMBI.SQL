SELECT U.ORGANIZADOR, U.CODIGO_INTERNO, U.USUARIO, SUM(B.CUSTO_BASE_TOTAL)-SUM(U.GANHOS_ATIVIDADES_TOTAIS) AS GANHOS_TOTAIS
    FROM (
        SELECT P.MOCHILEIRO AS USUARIO, -1*(SUM(G.GASTOS_GANHOS)) AS GANHOS_ATIVIDADES_TOTAIS, C.ORGANIZADOR, C.CODIGO_INTERNO 
        FROM PARTICIPA P JOIN CARAVANA C
        ON (P.ORGANIZADOR = C.ORGANIZADOR AND P.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ITINERARIO I
        ON (C.ORGANIZADOR = I.ORGANIZADOR AND C.CODIGO_INTERNO = I.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO) JOIN ATIVIDADE A
        ON (AD.ITINERARIO = A.ITINERARIO) JOIN GRUPO_DE_PARTICIPANTES G
        ON (A.ID = G.ATIVIDADE) JOIN ENTRA E
        ON (G.ATIVIDADE = E.ATIVIDADE AND G.CATEGORIA = E.CATEGORIA AND P.MOCHILEIRO = E.USUARIO AND E.USUARIO = AD.USUARIO)
        GROUP BY P.MOCHILEIRO, C.ORGANIZADOR, C.CODIGO_INTERNO
        
        UNION

        SELECT AU.ESPECIALISTA AS USUARIO, -1*(SUM(G.GASTOS_GANHOS)) AS GANHOS_ATIVIDADES_TOTAIS, C.ORGANIZADOR, C.CODIGO_INTERNO 
        FROM AUXILIA AU JOIN CARAVANA C
        ON (AU.ORGANIZADOR = C.ORGANIZADOR AND AU.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ITINERARIO I
        ON (C.ORGANIZADOR = I.ORGANIZADOR AND C.CODIGO_INTERNO = I.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO) JOIN ATIVIDADE A
        ON (AD.ITINERARIO = A.ITINERARIO) JOIN GRUPO_DE_PARTICIPANTES G
        ON (A.ID = G.ATIVIDADE) JOIN ENTRA E
        ON (G.ATIVIDADE = E.ATIVIDADE AND G.CATEGORIA = E.CATEGORIA AND AU.ESPECIALISTA = E.USUARIO AND E.USUARIO = AD.USUARIO)
        GROUP BY AU.ESPECIALISTA, C.ORGANIZADOR, C.CODIGO_INTERNO

    ) U
    JOIN (
        SELECT AD.USUARIO, SUM(AD.CUSTO_BASE) AS CUSTO_BASE_TOTAL, C.ORGANIZADOR, C.CODIGO_INTERNO
        FROM CARAVANA C JOIN ITINERARIO I
        ON (I.ORGANIZADOR = C.ORGANIZADOR AND I.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO)
        GROUP BY C.ORGANIZADOR, C.CODIGO_INTERNO, AD.USUARIO
    ) B 
    ON (U.USUARIO = B.USUARIO AND U.ORGANIZADOR = B.ORGANIZADOR AND U.CODIGO_INTERNO = B.CODIGO_INTERNO)
    GROUP BY U.USUARIO, U.ORGANIZADOR, U.CODIGO_INTERNO;

SELECT E.ESPECIALISTA, SUM(E.GANHOS_ATIVIDADES_TOTAIS)-SUM(B.CUSTO_BASE_TOTAL) AS GANHOS_TOTAIS, E.ORGANIZADOR, E.CODIGO_INTERNO
    FROM (
        SELECT AU.ESPECIALISTA, -1*(SUM(G.GASTOS_GANHOS)) AS GANHOS_ATIVIDADES_TOTAIS, C.ORGANIZADOR, C.CODIGO_INTERNO 
        FROM AUXILIA AU JOIN CARAVANA C
        ON (AU.ORGANIZADOR = C.ORGANIZADOR AND AU.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ITINERARIO I
        ON (C.ORGANIZADOR = I.ORGANIZADOR AND C.CODIGO_INTERNO = I.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO) JOIN ATIVIDADE A
        ON (AD.ITINERARIO = A.ITINERARIO) JOIN GRUPO_DE_PARTICIPANTES G
        ON (A.ID = G.ATIVIDADE) JOIN ENTRA E
        ON (G.ATIVIDADE = E.ATIVIDADE AND G.CATEGORIA = E.CATEGORIA AND AU.ESPECIALISTA = E.USUARIO AND E.USUARIO = AD.USUARIO)
        GROUP BY AU.ESPECIALISTA, C.ORGANIZADOR, C.CODIGO_INTERNO
    ) E
    JOIN (
        SELECT AD.USUARIO, SUM(AD.CUSTO_BASE) AS CUSTO_BASE_TOTAL, C.ORGANIZADOR, C.CODIGO_INTERNO
        FROM CARAVANA C JOIN ITINERARIO I
        ON (I.ORGANIZADOR = C.ORGANIZADOR AND I.CODIGO_INTERNO = C.CODIGO_INTERNO) JOIN ADENTRA AD
        ON (I.ID = AD.ITINERARIO)
        GROUP BY C.ORGANIZADOR, C.CODIGO_INTERNO, AD.USUARIO
    ) B 
    ON (E.ESPECIALISTA = B.USUARIO AND E.ORGANIZADOR = B.ORGANIZADOR AND E.CODIGO_INTERNO = B.CODIGO_INTERNO)
    GROUP BY E.ESPECIALISTA, E.ORGANIZADOR, E.CODIGO_INTERNO;
